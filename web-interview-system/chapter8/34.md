# 深度掌握前端框架底层机理


## 真正理解虚拟DOM（二）——Diff算法 & 面试考点解析


### diff 算法

React 并不会蠢蠢地每次都给你重新生成一棵全新的 DOM 树，它会机智地对比当下 Virtual DOM 树和旧 Virtual DOM 树之间的差别，然后找出两者的不同之处，从而确保每次只做最必要的改动。

这个“找不同”的过程——调和过程（Reconciliation），是个重点

Diff 算法既是亮点，也是考点。下面我们就一起来看看这个 O(n）复杂度的算法是如何实现的:
React 团队根据前端界面的特性，作了这样的假设：
1. 相同的组件有着相同的 DOM 结构，不同的组件有着不同的 DOM 结构
2. 位于同一层次的一组子节点，它们之间可以通过唯一的 id 进行区分
3. DOM 结构中，跨层级的节点操作非常少，可以忽略不计

先对比节点类型，再检查组件属性变化


### 数组动态生成的组件，为什么一定要有“key”？
key 是用来帮助 react 识别哪些内容被更改、添加或者删除。key 需要写在用数组渲染出来的元素内部，并且需要赋予其一个稳定的值。稳定在这里很重要，因为如果 key 值发生了变更，react 则会触发 UI 的重渲染。这是一个非常有用的特性。

tips：作为一个节点的唯一标识，在使用 key 之前，请务必确认 key 的唯一和稳定。


### 灵魂拷问：虚拟 DOM 真的性能更好吗？

- 跟直接操作 DOM 比，那恐怕还是直接操作 DOM 快一些。不过你想啊，直接操作 DOM 可是个苦力活，咱们早就淘汰这种操作了，不然哪来的模板呢？

- 跟模板比，这就有的比了。模板每次数据变更时，它会直接重置 DOM——哪怕变更的只是一小段数据。相比之下，虚拟 DOM 方案每次只更新必要的 DOM，虽然它增加了 diff 过程。但增加的是 js 计算，换来的可是 DOM 开销，这可是杠杆撬地球一般的操作。。。所以说，这种情况下，我们会认为虚拟 DOM 从性能上来讲会更合适。

React 并不承诺比直接操作 DOM 更快。但是别忘了，React 可是为我们提供了数据驱动、不用操心 DOM 细节的便利，在这个基础上，它仍然维持了一个过得去的性能。React 的强大之处不在于性能碾压了xx、碾压了xxx，而在于它在性能和开发体验&可维护性之间做到了一个很好的平衡。