# 深度掌握前端框架底层机理


## React基本功（三）——命题思路点拨


### React 组件设计模式

1. 什么是HoC（Higher-Order Component）？适用于什么场景？
    （1）什么是HOC？ HOC(Higher-order component)即高阶组件，主要还是为了便于组件的复用。HOC本身并不是React API，它就是一个方法，一个接收一个组件作为参数，并返回一个增强的组件的方法。 
    （2）HOC适用于什么场景？ 将几个功能相似的组件里面的方法和react特性（如生命周期里面的副作用）提取到HOC中，然后向HOC传入需要封装的组件。最后将公用的方法传给组件。

2. 什么时候应该选择用class实现一个组件，什么时候应该用一个函数实现一个组件？
    组件用到了state或者用了生命周期函数，那么就该class实现组件。其他情况下，应使用一个函数实现组件。

3. 你喜欢React Stateless组件吗？为什么？（发散题目 ）
    【1】喜欢React Stateless组件。 
    【2】因为它具有以下优点： 
    （1）代码整洁、可读性高 
    （2）没有this「由于使用的是箭头函数，事件无需绑定」 
    （3）组件不会被实例化，整体渲染性能得到提升
    （4）没有生命周期的方法和状态，只是一个方法，所以性能高「无状态组件本身性能提高不是很明显，完全取决于调用方式，如果按照传统的组件调用无状态组件那么性能提高微乎其微，如果按照方法的形式调用无状态组件，那么性能提高不少。无状态组件的调用如果按常规的方式调用，还是会创建元素、挂载，所以直接调用无状态组件性能最高」


### setState 深入

1. 当组件的setState函数被调用之后，会发生什么？
    React会做的第一件事就是把你传递给setState的参数对象合并到组件原先的state。这个事件会导致一个“reconciliation”（调和）的过程。reconciliation的最终目标就是，尽可能以最高效的方法，去基于新的state来更新UI。为了达到这个目的，React会构建一个React元素树（你可以把这个想象成一个表示UI的一个对象）。一旦这个树构建完毕，React为了根据新的state去决定UI要怎么进行改变，它会找出这棵新树和旧树的不同之处。React能够相对精确地找出哪些位置发生了改变以及如何发生了什么变化，并且知道如何只通过必要的更新来最小化重渲染。

2. setState可以接受函数为参数吗？有什么作用？
    （1）setState可以接受函数为参数。 
    （2）当 setState 执行完成且组件被渲染完成时，将调用回调函数。由于 setState 是异步的，因此下一步执行的任何操作都可以使用该回调函数。 【1】在 setState 完成后会调用回调函数，下一步需要执行的任何操作都可以使用该回调函数来实现。 
    【2】 建议使用生命周期方法而不是该回调函数。 
    【3】 setState 中的第一个参数也可以传入函数，其结构为 function(state, props) => newState。这个函数会将每次更新都加入队列中，执行时通过当前的 state 和 props 来获取新的 state。这样一来 React 就不会将对象合并（显然根本没有对象让他合并），把多次状态修改打包后进行一次批处理操作了。 」 

### 事件系统

1. React事件机制是怎样的？为什么它要定义一套事件体系？
    【1】React事件机制： 
    （1）当我们在组件上设置事件处理器时，React并不会在该DOM元素上直接绑定事件处理器，而是在React内部自定义一套事件系统，在这个系统上进行统一的事件订阅和分发 
    （2）React利用事件委托机制在Document上统一监听DOM事件，再根据触发的target将事件分发到具体的组件实例，实际我们在事件里面拿到的event其实并不是原始的DOM事件对象，而是一个合成事件对象 。 
    【2】React定义一套事件体系的原因： 
    （1）抹平不同浏览器之间的兼容性差异。最主要的动机。 
    （2）事件"合成"，即事件自定义。事件合成既可以处理兼容性问题，也可以用来自定义事件（例如 React 的 onChange 事件）。 
    （3）提供一个抽象跨平台事件机制。类似 VirtualDOM 抽象了跨平台的渲染方式，合成事件（SyntheticEvent）提供一个抽象的跨平台事件机制。 （4）可以做更多优化。例如利用事件委托机制，几乎所有事件的触发都代理到了 document，而不是 DOM 节点本身，简化了 DOM 事件处理逻辑，减少了内存开销。（React 自身模拟了一套事件冒泡的机制） 
    （5）可以干预事件的分发。V16引入 Fiber 架构，React 可以通过干预事件的分发以优化用户的交互体验。

### React 底层原理

1. 为什么我们利用循环产生的组件中要用上key这个特殊的prop？
    key负责帮助React跟踪列表中哪些元素被改变/添加/移除。React利用子元素的key在比较两棵树的时候，快速得知一个元素是新的还是刚刚被移除。没有key，React也就不知道当前哪一个的item被移除了。

2. 什么是Fiber？是为了解决什么问题？
    【1】React Fiber把更新过程碎片化，每执行完一段更新过程，就把控制权交还给React负责任务协调的模块，看看有没有其他紧急任务要做，如果没有就继续去更新，如果有紧急任务，那就去做紧急任务。 维护每一个分片的数据结构，就是Fiber。 
    【2】Fiber要解决的问题： 
    （1）能够将可中断的任务拆分成块。 
    （2）能够对进程中的工作划分优先级、重新设定基址（Rebase）、恢复。 
    （3）能够在父子之间来回反复，借此为 React 的 Layout 提供支持。 
    （4）能够通过 render() 返回多个元素。 
    （5）为错误边界提供了更好的支持。